(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{660:function(s,t,n){"use strict";n.r(t);var e=n(6),a=Object(e.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"title"}),n("p",[s._v("​\t\t众所周知，通常情况下"),n("code",[s._v("Vite")]),s._v("要比"),n("code",[s._v("Webpack")]),s._v("快，但经过实际感受，默认情况下，Vite项目的启动速度确实很快，但如果某个界面是第一次进入，且依赖比较多或者比较复杂的话，就会很慢，这篇博客来讨论一下这个问题（Vite2.x版本）。")])]),n("h2",{attrs:{id:"vite到底是快还是慢"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vite到底是快还是慢"}},[s._v("#")]),s._v(" Vite到底是快还是慢？")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("​\t\t单方面说Vite快太过笼统，但Vite项目的启动确实非常快("),n("strong",[s._v("这里的启动指的是命令行启动完毕，而不是页面加载完毕的时间")]),s._v(")")]),s._v(" "),n("p",[s._v("​\t\t但启动完之后，打开首页，如果依赖的资源比较多，那么有可能慢到让你怀疑人生")]),s._v(" "),n("p",[s._v("​\t\t简单来说，"),n("code",[s._v("Vite")]),s._v("之所以启动那么快，是因为它启动时不会像"),n("code",[s._v("Webpack")]),s._v("那样对所有代码进行编译/打包/压缩，而是采用"),n("code",[s._v("bundless")]),s._v("的思路，启动时只进行第三方依赖的预构建，实际浏览器访问的时候，再通过本地服务器实时转换每个请求的文件，达到缩短首次启动时间的目的。")]),s._v(" "),n("p",[s._v("​\t\t关于Vite的具体原理可以参考: "),n("a",{attrs:{href:"https://github.com/willson-wang/Blog/issues/101",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vite原理与实践记录"),n("OutboundLink")],1)])]),n("h2",{attrs:{id:"对vite启动后页面加载的过程进行分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#对vite启动后页面加载的过程进行分析"}},[s._v("#")]),s._v(" 对Vite启动后页面加载的过程进行分析")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("ul",[n("li",[n("strong",[s._v("打开浏览器开发者工具，可以看到请求了很多的资源")])]),s._v(" "),n("li",[n("strong",[s._v("终端中也会显示:")]),s._v(" "),n("ul",[n("li",[n("strong",[n("code",[s._v("[vite] new dependencies found: axios, updating...")])])]),s._v(" "),n("li",[n("strong",[n("code",[s._v("[vite] ? dependencies updated, reloading page...")])])])])]),s._v(" "),n("li",[n("strong",[s._v("同时，界面会被强制刷新一次")])])])]),n("p",[n("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/Ocean-H1/blog_image_bed/202303151659092.gif",alt:"Vite启动"}})]),s._v(" "),n("p",[s._v("具体的性能分析可参考下面这篇文章:")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.cnblogs.com/hetaojs/p/15386371.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vite首次启动加载慢"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),n("h3",{attrs:{id:"在vite2-x之前"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在vite2-x之前"}},[s._v("#")]),s._v(" 在Vite2.x之前")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("​\t\t官方文档中有简单提到这个问题的解决方式："),n("a",{attrs:{href:"https://vitejs.cn/config/#preview-cors",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vite官网: 依赖优化选项"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("​\t\t总之就是在"),n("code",[s._v("vite.config.ts")]),s._v("中进行配置，让Vite能在启动之初就对某些资源进行预打包，避免启动完成后再进行动态打包。")])]),n("div",{staticClass:"language-typescript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   optimizeDeps"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      include"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'map-factory'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/form/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/radio-group/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/radio/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/checkbox/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/checkbox-group/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/switch/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/time-picker/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/date-picker/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/col/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/form-item/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/alert/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/breadcrumb/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/select/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/input/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/breadcrumb-item/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/tag/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/pagination/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/table/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/table-column/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/card/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/row/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/button/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/menu/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/sub-menu/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/menu-item/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/es/components/option/style/index'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@element-plus/icons-vue'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pinia'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'axios'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue-request'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue-router'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@vueuse/core'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])]),n("p",[s._v("成功配置之后，再次启动Vite，会看到多了"),n("code",[s._v("Pre-bundling dependencies")]),s._v("的信息:")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://fastly.jsdelivr.net/gh/Ocean-H1/blog_image_bed/202303151716355.png",alt:"Vite Start"}})]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"title"}),n("p",[s._v("​\t\t但实际上，每次都进行手动配置太麻烦，也增加了开发人员的心智负担,在"),n("code",[s._v("Vite2.x")]),s._v("之前，可以使用插件来进行配置。\n​\t\t"),n("a",{attrs:{href:"https://www.npmjs.com/package/vite-plugin-optimize-persist",target:"_blank",rel:"noopener noreferrer"}},[s._v("NPM: vite-plugin-optimize-persist"),n("OutboundLink")],1)])]),n("h4",{attrs:{id:"插件使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插件使用"}},[s._v("#")]),s._v(" 插件使用")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("npm i -D vite-plugin-optimize-persist vite-plugin-package-config\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("strong",[s._v("在 vite.config.ts中配置Plugins")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-typescript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// vite.config.ts")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" OptimizationPersist "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vite-plugin-optimize-persist'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" PkgConfig "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vite-plugin-package-config'")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  plugins"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("PkgConfig")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("OptimizationPersist")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("div",{staticClass:"custom-block warning"},[n("p",{staticClass:"title"}),n("p",[s._v("​\t\t注意： 首次加载的时候，依然会很慢，这个是正常现象，因为这个插件, 加快vite载入界面速度的原理, 也和上面说的一样，而第一次，这个插件也没法知道，哪些依赖需要预构建，他只是在vite动态引入资源的时候，将这些资源都记录下来，自动写入了package.json中，当再次启动项目的时候，插件会读取之前他写入在package.json中的数据，并告知vite，这样vite就能对这些资源进行预构建了，也就能加快进入界面的速度了，但相应的启动速度就会比原来稍微慢一点")]),s._v(" "),n("p",[s._v("​\t\t实际上，"),n("code",[s._v("vite")]),s._v("第二次启动本来就有缓存，本来就会比第一次快，那这个插件岂不是没有意义了？当然还是有意义的，如果在这之后，被人再拿到你的源代码，因为"),n("code",[s._v("package.json")]),s._v("中已经有了预构建配置了，所以，他"),n("strong",[s._v("的"),n("code",[s._v("vite")]),s._v("在第一次启动时，就能对资源进行预构建了")]),s._v("，另外，如果你由于某些原因需要删除"),n("code",[s._v("node_modules/.vite")]),s._v("这个缓存目录, 由于有这个插件，你的这次首次启动也会快起来")])]),n("p",[s._v("参考链接：")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/willson-wang/Blog/issues/101",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vite原理与实践记录"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.cnblogs.com/hetaojs/p/15386371.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vite首次启动加载慢"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"https://carljin.com/vite-resolve-request-files-a-ton",target:"_blank",rel:"noopener noreferrer"}},[s._v("Vite解决项目刷新慢问题(请求量过大)"),n("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=a.exports}}]);